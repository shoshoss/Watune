<%= turbo_stream.replace "main-content" do %>
  <%= render partial: 'profiles/show', locals: { user: @user, posts: @posts, pagy: @pagy, initial_category: @initial_category, notifications: @notifications } %>
<% end %>

<%= turbo_stream.update "after-widget" do %>
  <%= render 'shared/widget', users: @recent_users %>
<% end %>

<%= turbo_stream.update "flash" do %>
  <%= render 'shared/flash_message' %>
<% end %>

<%= turbo_stream.replace "scripts" do %>
  <%= javascript_tag do %>
    document.addEventListener("turbo:load", function() {
      history.pushState(null, "", "<%= profile_show_path(username_slug: @user.username_slug, category: params[:category]) %>");
      const category = new URLSearchParams(window.location.search).get('category');
      if (category) {
        document.querySelectorAll('.c-profile-tab').forEach(tab => {
          if (tab.href.includes(`category=${category}`)) {
            tab.classList.add('active');
            tab.scrollIntoView({ behavior: 'smooth', inline: 'center' });
          } else {
            tab.classList.remove('active');
          }
        });
      }
    });
  <% end %>
<% end %>
